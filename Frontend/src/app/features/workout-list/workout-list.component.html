<div class="workout-page-container">
  <div class="page-header">
    <div>
      <h2>Twoje Treningi</h2>
      <p>≈öled≈∫ swoje postƒôpy i dodawaj nowe aktywno≈õci</p>
    </div>
    <button class="btn-main-add" (click)="toggleForm()">
      {{ showAddForm() ? 'Anuluj dodawanie' : '+ Dodaj Trening' }}
    </button>
  </div>

  <div class="quick-stats">
    <div class="stat-card">
      <span class="label">Wszystkie treningi</span>
      <span class="value">{{ totalWorkouts() }}</span>
    </div>
    <div class="stat-card">
      <span class="label">Czas na treningach</span>
      <span class="value"><span class="highlight">{{ totalDuration() }}</span> min</span>
    </div>
    <div class="stat-card">
      <span class="label">Spalone kalorie</span>
      <span class="value"><span class="highlight">{{ totalKcal() }}</span> kcal</span>
    </div>
  </div>

  @if (showAddForm()) {
    <div class="add-workout-form fade-in">
      <div class="form-header">
        <h3>{{ isEditing() ? 'Edytuj trening' : 'Nowy Trening' }}</h3>
        <p>Wybierz typ i uzupe≈Çnij szczeg√≥≈Çy</p>
      </div>

      <div class="type-selector">
        <button [class.active]="selectedType() === 'CARDIO'" (click)="setWorkoutType('CARDIO')">üèÉ Cardio</button>
        <button [class.active]="selectedType() === 'Gym'" (click)="setWorkoutType('Gym')">üèãÔ∏è Si≈Çownia</button>
      </div>

      <div class="form-section-label">Dane podstawowe</div>
      <div class="form-grid">
        <div class="form-group">
          <label>Data</label>
          <input type="date" [(ngModel)]="newWorkout.date" name="date">
        </div>
        <div class="form-group">
          <label>Czas trwania</label>
          <input type="number" [(ngModel)]="newWorkout.duration" name="duration" placeholder="np. 45">
          <span class="hint">W minutach</span>
        </div>
        <div class="form-group">
          <label>Kalorie</label>
          <input type="number" [(ngModel)]="newWorkout.calories" name="calories" placeholder="np. 350">
          <span class="hint">Spalone kcal</span>
        </div>
      </div>

      @if (selectedType() === 'CARDIO') {
        <div class="form-section-label">Szczeg√≥≈Çy aktywno≈õci (Cardio)</div>
        <div class="form-grid">
          <div class="form-group">
             <label>Dystans</label>
             <input type="number" step="0.01" [(ngModel)]="newWorkout.distance" name="distance" placeholder="np. 5.5">
             <span class="hint">Przebyty dystans (w km)</span>
          </div>
          <div class="form-group">
             <label>≈ör. Tƒôtno</label>
             <input type="number" [(ngModel)]="newWorkout.heartRate" name="heartRate" placeholder="np. 145">
             <span class="hint">Uderzenia na minutƒô (BPM)</span>
          </div>
          <div class="form-group">
             <label>Tempo</label>
             <input type="number" step="0.1" [(ngModel)]="newWorkout.pace" name="pace" placeholder="np. 5.30">
             <span class="hint">Czas na 1 km (min/km)</span>
          </div>
        </div>
      }

      @if (selectedType() === 'Gym') {
        <div class="gym-section">
          <div class="form-section-label">Szczeg√≥≈Çy treningu (Si≈Çownia)</div>
          
          @if (newWorkout.exercises && newWorkout.exercises.length > 0) {
            <div class="added-exercises-list fade-in">
              @for (ex of newWorkout.exercises; track $index) {
                <div class="exercise-item">
                  <div>
                    <span class="ex-name">{{ $index + 1 }}. {{ ex.name }}</span>
                    <span class="ex-details">{{ ex.weight }} kg ‚Ä¢ {{ ex.count }} serie x {{ ex.reps }} powt.</span>
                  </div>
                  <button class="btn-remove-item" style="color: #ff4757;" (click)="removeExerciseFromForm($index)" title="Usu≈Ñ ƒáwiczenie">‚ùå</button>
                </div>
              }
            </div>
          }

          <div class="add-exercise-box">
            <div class="subform-header">+ Dodaj kolejne ƒáwiczenie do treningu</div>
            
            <div class="form-group full-width" style="margin-bottom: 1rem;">
               <label>Nazwa ƒáwiczenia</label>
               <input type="text" [(ngModel)]="currentExercise.name" name="exName" placeholder="np. Wyciskanie sztangi le≈ºƒÖc, Przysiad...">
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                 <label>Ciƒô≈ºar</label>
                 <input type="number" step="0.5" [(ngModel)]="currentExercise.weight" name="exWeight" placeholder="np. 60">
                 <span class="hint">ObciƒÖ≈ºenie (w kg)</span>
              </div>
              <div class="form-group">
                 <label>Serie</label>
                 <input type="number" [(ngModel)]="currentExercise.count" name="exCount" placeholder="np. 4">
                 <span class="hint">Liczba wykonanych serii</span>
              </div>
              <div class="form-group">
                 <label>Powt√≥rzenia</label>
                 <input type="number" [(ngModel)]="currentExercise.reps" name="exReps" placeholder="np. 10">
                 <span class="hint">Liczba powt. w serii</span>
              </div>
            </div>

            <button class="btn-add-to-list" (click)="addExerciseToForm()">Dodaj ƒáwiczenie do listy</button>
          </div>
        </div>
      }

      <div class="form-actions">
        <button class="btn-cancel" (click)="toggleForm()">Anuluj</button>
        <button class="btn-submit" (click)="submitWorkout()">Zapisz ca≈Çy trening</button>
      </div>
    </div>
  }

  @if (isLoading()) {
    <div class="empty-state fade-in">
      <p>≈Åadowanie trening√≥w...</p>
    </div>
  } @else if (userWorkouts().length === 0) {
    <div class="empty-state fade-in">
      <div class="empty-icon">ü§∑‚Äç‚ôÇÔ∏è</div>
      <h3>Brak trening√≥w</h3>
      <p>Jeszcze nic nie doda≈Çe≈õ. Kliknij przycisk powy≈ºej, aby dodaƒá sw√≥j pierwszy trening i zaczƒÖƒá ≈õledziƒá postƒôpy!</p>
    </div>
  } @else {
    <div class="workouts-list fade-in">
      @for (workout of userWorkouts(); track workout.id) {
        <div class="workout-card">
          <div class="card-left">
            <div class="type-indicator" [ngClass]="workout.type === 'CARDIO' ? 'cardio' : 'strength'"></div>
            <div class="icon-box">
              {{ workout.type === 'CARDIO' ? 'üèÉ' : 'üèãÔ∏è' }}
            </div>
          </div>
          <div class="card-content">
            <div class="header">
              <h4>{{ workout.type === 'CARDIO' ? 'Trening Cardio' : 'Trening Si≈Çowy' }}</h4>
              <span class="date">{{ workout.date | date:'dd.MM.yyyy' }}</span>
            </div>
            <div class="stats-row">
              <span class="stat-pill highlight">‚è≥ {{ workout.duration }} min</span>
              <span class="stat-pill highlight">üî• {{ workout.calories }} kcal</span>
              
              @if (workout.type === 'CARDIO') {
                <span class="stat-pill">üìç {{ workout.distance }} km</span>
                <span class="stat-pill">‚ù§Ô∏è {{ workout.heartRate }} BPM</span>
              }
              
              @if (workout.type === 'Gym' && workout.exercises) {
                <span class="stat-pill">üìã {{ workout.exercises.length }} ƒáwicze≈Ñ</span>
              }
            </div>
          </div>
          <div class="card-actions">
            <button class="action-btn edit" (click)="startEdit(workout)" title="Edytuj">‚úèÔ∏è</button>
            <button class="action-btn delete" (click)="deleteWorkoutHandler(workout.id)" title="Usu≈Ñ">üóëÔ∏è</button>
          </div>
        </div>
      }
    </div>
  }
</div>